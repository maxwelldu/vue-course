#cp-lessons
#课程介绍
常用的ES6特性；
对象拷贝，默认参数，字符串模板，解构赋值，箭头函数，Set和Map, 异步操作，类和对象，模块化

##ES6是基本技能
源码：学习Vue, Element, D3
业务：vue, react, angular
面试：加分项

gulp, babel, webpack, npm完成构建工具
基础语法：基础用法，代码示例，注意事项
实战演练：Express, MockJS
实现一个彩票，电商是比较复杂的，彩票又是电商当中最复杂的

预备：模块化概念，工程构建，编程经验

#ES6项目构建
- 基础架构（目录，文件，模块化）
- 任务自动化（gulp）
- 编译工具（babel、webpack）[sass,less,stylus, jade, es6, typescript] 文件压缩,项目依赖
- 代码实现(部署环境)

业务逻辑
  页面
  交互
自动构建
  编译
  辅助
    自动刷新
    文件合并
    资源压缩
服务接口
  数据
  接口

任务自动化gulp
  什么是任务自动化，自动监听
  什么是gulp, 之前有grunt会比较慢，不是流操作
  gulp的作用（提供了插件完成任务）
  了解如何使用gulp完成任务自动化（了解实用的插件）

编译工具（babel, webpack）
  什么是babel、webpack
  babel的核心用法
  了解webpack及webpack-stream的作用（webpack-stream是对gulp的支持）

代码实现
  创建一个ES6前端工程
  完成目录结构，自动构建，服务器搭建

#项目目录的搭建
express使用的模板引擎是ejs
提前安装nodejs
安装express的生成器

mkdir es6
cd es6
mkdir app server tasks
cd app
mkdir css js views
ls
mkdir js/class
touch js/class/test.js
touch js/index.js
touch views/err.ejs
touch views/index.ejs
cd ../server
//使用ejs模板引擎，在当前目录
express -e .
npm i
cd ../tasks
mkdir util
touch util/args.js
cd ..
ls
npm init -y
touch .babelrc
touch gulpfile.babel.js
touch .gitignore
vim .gitignore
```
# Logs
logs
*.log

# Runtime data
pids
*.pid
*.seed

# Directory for instrumented libs generated by jscoverage/JSCover
lib-cov

# Coverage directory used by tools like istanbul
coverage

# Grunt intermediate storage (http://gruntjs.com/creating-plugins#storing-task-files)
.grunt

# node-waf configuration
.lock-wscript

# Compiled binary addons (http://nodejs.org/api/addons.html)
build/Release

# Dependency directory
# https://www.npmjs.org/doc/misc/npm-faq.html#should-i-check-my-node_modules-folder-into-git
node_modules

```

#命令行处理，创建JS编译任务脚本
vim tasks/util/args.js
```
import yargs from 'yargs';
const args = yargs
  .option('production', {
    boolean: true,
    default: false,
    describe: 'min all scripts'
  })

  .option('watch', {
    boolean: true,
    default: false,
    describe: 'watch all files'
  })

  .option('verbose', {
    boolean: true,
    default: false,
    describe: 'log'
  })

  .option('sourcemaps', {
    describe: 'force the creation of sourcemaps'
  })

  .option('port', {
    string: true,
    default: 8080,
    describe: 'server port'
  })
  .argv;
  export default args;
```

touch tasks/scripts.js
vim tasks/scripts.js
```
import gulp from 'gulp';
import gulpif from 'gulp-if';
import concat from 'gulp-concat';
import webpack from 'webpack';
import gulpwebpack from 'webpack-stream';
import named from 'vinyl-named';
import livereload from 'gulp-livereload';
import plumber from 'gulp-plumber';
import rename from 'gulp-rename';
import uglify from 'gulp-uglify';
import {log, colors} from 'gulp-util';
import args from './util/args';

```
npm i -D gulp gulp-if gulp-concat webpack webpack-stream vinyl-named gulp-livereload gulp-plumber gulp-rename gulp-uglify gulp-util yargs
cat package.json

vim tasks/scripts.js
```
gulp.task('scripts', () => {
  return gulp.src(['app/js/index.js'])
  .pipe(plumber({
    errorHandle: function(){

    }
  }))
  .pipe(named())
  .pipe(gulpwebpack({
    module: {
      loaders: [{
        test: /\.js$/,
        loader: 'babel-loader'
      }]
    }
  }), null, (err, stats) => {
    log(`Finished '${colors.cyan('scripts')}'`, stats.toString({
      chunks: false
    }))
  })
  .pipe(gulp.dest('server/public/js'))
  .pipe(rename({
    basename: 'cp',
    extname: '.min.js'
  }))
  .pipe(uglify({compress:{properties: false}, output:{'quote_keys':true}}))
  .pipe(gulp.dest('server/public/js'))
  .pipe(gulpif(args.watch, livereload()))
})
```

##创建模板、服务任务脚本
touch tasks/pages.js
vim tasks/pages.js
```
import gulp from 'gulp';
import gulpif from 'gulp-if';
import livereload from 'gulp-livereload';
import args from './util/args';

gulp.task('pages', () => {
  return gulp.src('app/**/*.ejs')
  .pipe(gulp.dest('server'))
  .pipe(gulpif(args.watch, livereload()))
  })
```

vim tasks/css.js
```
import gulp from 'gulp';
import gulpif from 'gulp-if';
import livereload from 'gulp-livereload';
import args from './util/args';

gulp.task('css', () => {
  return gulp.src('app/**/*.css')
  .pipe(gulp.dest('server/public'))
  })
```

vim tasks/server.js
```
import gulp from 'gulp';
import gulpif from 'gulp-if';
import liveserver from 'gulp-live-server';
import args from './util/args';

gulp.task('serve', (cb) => {
  if (!args.watch) return cb();

  var server = liveserver.new(['--harmony', 'server/bin/www']);
  server.start();

  gulp.watch(['server/public/**/*.js', 'server/views/**/*.ejs'], function(file) {
    server.notify.apply(server, [file]);
  })

  gulp.watch(['server/routes/**/*.js', 'server/app.js'], function() {
    server.start.bind(server)()
  });

})

```

##文件自动监听
vim tasks/browser.js
```
import gulp from 'gulp';
import gulpif from 'gulp-if';
import gutil from 'gulp-util';
import args from './util/args';

gulp.task('browser', (cb) => {
  if (!args.watch) return cb();
  gulp.watch('app/**/*.js', ['scripts']);
  gulp.watch('app/**/*.ejs', ['pages']);
  gulp.watch('app/**/*.css', ['css']);
});
```

vim tasks/clean.js
```
import gulp from 'gulp';
import del from 'del';
import args from './util/args';

gulp.task('clean', () => {
  return del(['server/public', 'server/views'])
})
```

npm i -D gulp-live-server del gulp-util babel-loader babel-core babel-preset-env babel-preset-es2015 webpack require-dir gulp-sequence connect-livereload babel-polyfill babel-plugin-transform-decorators-legacy

vim tasks/build.js
```
import gulp from 'gulp';
import gulpSequence from 'gulp-sequence';
gulp.task('build', gulpSequence('clean', 'css', 'pages', 'scripts', ['browser', 'serve']));
```

vim tasks/default.js
```
import gulp from 'gulp';
gulp.task('default', ['build']);
```

vim gulpfile.babel.js
```
import requireDir from 'require-dir';
requireDir('./tasks');
```

vim .babelrc
```
{
  "presets": ["es2015"],
  "plugins": ["transform-decorators-legacy"]
}
```
vim server/app.js
```
//在路由 app.use('/', routes); 前面添加一行
app.use(require('connect-livereload')());
```
gulp --watch

访问: localhost:3000
vim app/views/index.ejs
```
es6
```
修改文件，测试是否能热更新
vim app/js/index.js
```
class Test {
  constructor() {
    this.a = 'hello world'
  }
}

let test = new Test();
document.body.innerHTML = test.a;
```

vim app/views/index.ejs
```
<script src="/js/index.js"></script>
```

#语法
##let.const
作用域的概念
  ES5有两个作用域，全局和函数
  ES6新增了一个块作用域
如何使用let和const, 和var的区别
一定要注意的事项
vim app/js/class/1-let.const.js
```
function test() {
  let a = 1;
  console.log(a);
}
test();
```

vim app/js/index.js
```
import './class/1-let.const.js';

```
gulp --watch
127.0.0.1:3000
打开命令行查看

解构赋值
  什么是解构赋值，左边的结构和右边的结构一样
  解构赋值的分类
    数组
    对象
    字符串
    布尔值
    函数参数
    数值

正则扩展
  新增特性
    构造函数的变化
    正则方法的扩展
    u修饰符
    y修饰符
    s修饰符
字符串扩展
  字符串新增特性
    unicode表示法
    遍历接口
    模板字符串（underscore, handlebar）
    新增方法（10种）
数值扩展
  数值处理新增特性
    1.新增方法
    2.方法调整，将parseInt放到Number对象上面了
数组扩展
  数组新增特性
    Array.from
    Array.of
    copyWithin
    find\findIndex
    fill
    entries\keys\values
    includes
函数扩展
  函数新增特性
    参数默认值
    rest参数
    扩展运算符
    箭头函数
    this绑定: ES5中的this是函数被调用时的对象，而箭头函数中的this是函数定义时候的对象所在; 新的提案当有两个冒号的使用方式
    尾调用
对象扩展
  对象新增特性
    简洁表示法
    属性表达式
    扩展运算符
    Object新增方法
Symbol
  Symbol的概念
    提供一个独一无二的值，在JS中声明一个变量A值为5，再声明一个变量B为5，他们可以相等；用Symbol声明的两个变量永远都不会相等
  Symbol的作用
数据结构
  Set的用法, 当数组用，但是不重复
  WeakSet的用法
  Map的用法, 类似Object, object的属性一定是字符串，Map的属性可以是任意类型
  WeakMap的用法

  Map与Array的对比
  Set与Array的对比
Proxy和Reflect
  Proxy和Reflect的概念
    代理对象和反射对象，使用方法是一样的
  Proxy和Reflect的适用场景
类
  类的概念
    基本语法
    类的继承
    静态方法
    静态属性
    getter
    setter
Promise
  什么是异步
  Promise的作用
  Promise的基本用法
Iterator和for...of循环
  什么是Iterator接口
    数组，二维对象，map和set都是数据集合，怎么样用一种相同方法的接口去读取不同数据类型的数据
  Iterator的基本用法
  for...of 背后是iterator
Generator
  基本概念
    异步的一种解决方案，之前有回调，后来有promise,相对于promise更高级
  next函数的用法
  yield*的语法
    generator中的一部分
Decorator（修饰器）
  基本概念
    一句话描述：修饰器是一个函数用来修改类的形为
    1.修饰器是一个函数
    2.修改行为
    3.修改类的行为, 之前怎么定义就怎么定义，扩展功能, 只能修改类
  基本用法
模块化
  基本概念（国外的require.js, 国内的sea.js）nodejs里面也有模块化的概念
  ES6的模块化语法（进行标准化，import, export）

#彩票项目实战
快频彩种（11选5）
  为什么要选彩票项目？
    互联网流行项目分私信，电商，彩票（也算电商行为，单独拿出来，复杂度高），旅游，金融；
  为什么选11选5快频彩种？
    11选5是彩票中类型的一种名称
    2017040873是期号，10分钟一期，每10分钟开一次奖，一天是78期
    倒计时是截止到当期结束
    彩票的销售状态
    彩票的选号投注
    玩法提示
    选号区，选中后下面要计算金额和盈利，资金，注数，花的钱，这里涉及到彩票的算法
    选择确认选号会有DOM操作
    大小奇偶，全部
    机选
  怎么用ES6解决传统的开发模式，这里有很多技巧，要注意
  功能模块
    倒计时
    玩法切换
    计算金额
    添加号码
    投注支付
    随机号码
    资金预测
    状态更新
    动态遗漏
  覆盖知识点
    let和const
    解构赋值
    正则扩展
    数值扩展
    数组扩展
    函数扩展
    对象扩展
    字符串扩展
    Symbol
    数据结构
    Proxy
    Reflect
    类
    Promise
    Generator
    模块化
  代码组织和架构，如何思考
    基于面向对象，模块化
    模块化要实现的目标就是功能单一，每个模块的功能都是单一的
    划分一下哪个模块是独立出来的
      功能模块（倒计时） 随便做什么项目都可以用到倒计时
      所有跟运算相关的分出一个模块，他和彩票的关系也不大，可以解耦，我们创建一个计算模块
      第几期的数据是来自体彩或福彩中心，这个倒计时的时间也是由api来的，不能简单的加1，有一个遗漏，11选5，每次会开5个中奖号码，没出的就叫遗漏，落下了，根据当中中奖号码推测哪些号码没有中奖，会统计某个号码有多少期没出了，这个叫遗漏，这个数据是自己的服务端统计的，我们把所有和接口相关的东西都封装在一起，叫接口模块
      还需要创建一个最根本的模块，用来描述彩票的，比如玩法提示，有多少号码，计算规则，中奖逻辑, base模块
      最后再创建一个模块用来整合上面的四个模块，封装成一个完整的模块, 最后index.js引入这个模块即可
    在js目录下创建lottery目录，里面放base.js, calculate.js, interface.js, timer.js
    在js目录放lottery.js, 文件里面引入上面的四个模块, 在入口文件index.js中引入lottery
  模板，css, 服务端的接口不是重点，我们都提前准备好

#总结
常用的ES6知识点
  let和const
  解构赋值
  正则扩展
  数值扩展
  数组扩展
  函数扩展
  对象扩展
  字符串扩展
  Symbol
  数据结构
  Proxy
  Reflect
  类
  Promise
  Generator
  模块化

注意事项
  使用严格模式，注意作用域
  使用类与对象，结合模块化构建中大型项目
  使用Promise替换传统的回调函数
  使用箭头函数要注意this的指向
  学会使用Generator完成异步操作应用
